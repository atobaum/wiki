<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Atobaum Wiki</title><link rel=stylesheet href=https://atobaum.github.io/css/index.css><link rel=stylesheet href=https://atobaum.github.io/css/reset.css><link rel=apple-touch-icon sizes=180x180 href=https://atobaum.github.io/fav/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://atobaum.github.io/fav/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://atobaum.github.io/fav/favicon-16x16.png><link rel=manifest href=https://atobaum.github.io/fav/site.webmanifest></head><body><div id=wrap><header id=gheader><div class="flex flex-jsb"><div id=logo><a href=https://atobaum.github.io>Atobaum Wiki</a></div><nav class=right0><ul id=gnb><li><a href=/about>about</a></li><li><a href=/>all</a></li><li><a href=/random>random</a></li><li><a href=/tags>tags</a></li></ul></nav></div><div id=search class=flex-end>searchbar</div></header><div id=main><h1>우아한테크캠프 2020, 2주차 기록</h1><h3 class=content-summary>이번주에 배운 것을 기록해보자</h3><div><div><ul class=tag-list><li class=tag><a href=https://atobaum.github.io/tags/record>#Record</a></li></ul></div><div class=content-meta><ul><li>작성: 2020-07-22<li></li>수정: 2020-07-22</li></ul>4 분 걸려요.</div><div><article class=content-article><h1 id=개요>개요</h1><p>이 글은 babel, webpack, jest를 어떻게 설정할 지 자세하지 않게 말해준다. 조만간 내용은 여러 글로 찢어지게 될 것이다.</p><p>더 쓸 것들</p><ul><li>docker-compose</li><li>implementing drag w/o api<ul><li>using event <code>mousedown</code>, <code>mouseup</code></li></ul></li></ul><h1 id=setting-up-babelwebpack>Setting up babel/webpack</h1><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm install @babel/core @babel/cli @babel/preset-env --save-dev
</code></pre></div><p>바벨은 아무일도 하지 않는다. Transpile을 하는 것은 babel plugins. 어떤게 있나:</p><ul><li>@babel/plugin-transform-arrow-functions</li></ul><p>여러가지 플러그인을 일일히 설치하는 것을 피곤하니까 그걸 한데 묶어 누가 만든 것이 preset:</p><ul><li>@babel/preset-env</li><li>@babel/preset-react</li><li>@babel/preset-typescript
등등&mldr;</li></ul><p>@babel/preset-env를 설치하고 설정하자:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm install --save-dev @babel/preset-env
</code></pre></div><p>.babelrc 파일에서</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#268bd2;font-weight:700>&#34;presets&#34;</span>: [<span style=color:#2aa198>&#34;@babel/preset-env&#34;</span>]
}
</code></pre></div><p>그런데 @babel/preset-env가 하는 일이 너무 많아요. 전세계 1%의 브라우저는 버리자:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#268bd2;font-weight:700>&#34;presets&#34;</span>: [
    [
      <span style=color:#2aa198>&#34;@babel/preset-env&#34;</span>,
      {
        <span style=color:#268bd2;font-weight:700>&#34;targets&#34;</span>: <span style=color:#2aa198>&#34;last 2 versions, &gt; 1%&#34;</span>
      }
    ]
  ]
}
</code></pre></div><p>각 브라우저의 마지막 두버전과 점유율이 1%를 넘는 브라우저를 지원한다.
<a href="https://browserl.ist/?q=last+2+versions%2C+%3E+1%25">browserl.ist</a>를 통해 확인할 수 있다.</p><h2 id=webpack>Webpack</h2><p>이제 webpack을 설정해보자</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm install --save-dev webpack webpack-cli
</code></pre></div><p>Webpack이 번들링을 할 때 babel을 사용하기 위해 babel-loader도 사용한다.</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm install --save-dev babel-loader
</code></pre></div><p><code>webpack.config.js</code> 파일에서 웹펙 설정을 한다.</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#859900>const</span> <span style=color:#268bd2>path</span> = <span style=color:#268bd2>require</span>(<span style=color:#2aa198>&#34;path&#34;</span>);

<span style=color:#268bd2>module</span>.<span style=color:#268bd2>exports</span> = {
  <span style=color:#268bd2>entry</span>: <span style=color:#2aa198>&#34;./src/index.js&#34;</span>,
  <span style=color:#268bd2>output</span>: {
    <span style=color:#268bd2>path</span>: <span style=color:#268bd2>path</span>.<span style=color:#268bd2>resolve</span>(<span style=color:#268bd2>__dirname</span>, <span style=color:#2aa198>&#34;dist/static&#34;</span>),
    <span style=color:#268bd2>filename</span>: <span style=color:#2aa198>&#34;bundle.js&#34;</span>,
  },
  <span style=color:#268bd2>module</span>: {
    <span style=color:#268bd2>rules</span>: [
      {
        <span style=color:#268bd2>test</span>: <span style=color:#2aa198>/\.js$/</span>,
        <span style=color:#268bd2>include</span>: [<span style=color:#268bd2>path</span>.<span style=color:#268bd2>resolve</span>(<span style=color:#268bd2>__dirname</span>, <span style=color:#2aa198>&#34;src&#34;</span>)],
        <span style=color:#268bd2>exclude</span>: <span style=color:#2aa198>/node_modules/</span>,
        <span style=color:#268bd2>use</span>: {
          <span style=color:#268bd2>loader</span>: <span style=color:#2aa198>&#34;babel-loader&#34;</span>,
          <span style=color:#268bd2>options</span>: {
            <span style=color:#268bd2>presets</span>: [
              [
                <span style=color:#2aa198>&#34;@babel/preset-env&#34;</span>,
                {
                  <span style=color:#268bd2>target</span>: <span style=color:#2aa198>&#34;last 2 versions, &gt; 1%&#34;</span>,
                },
              ],
            ],
          },
        },
      },
    ]
  },
  <span style=color:#268bd2>devtool</span>: <span style=color:#2aa198>&#34;source-map&#34;</span>,
  <span style=color:#268bd2>mode</span>: <span style=color:#2aa198>&#34;development&#34;</span>,
};
</code></pre></div><p>웹팩은 entry point에서 시작해 의존성이 있는 것들을 한데 모아 합쳐준다. 결과물을 저장하는 경로와 파일명을 정해줄 수 있다.</p><p>여러 파일들을 읽으면서 확장자에 따라 처리하는 일을 다르게 설정할 수 있다. 위의 설정에서는 <code>./src/</code> 안에 있는 자바스크립트파일들을 바벨을 이용해 트랜스파일해준다.</p><p>다음으로 css를 임포트하면 웹팩은 어떻게 할까?</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm i -D css-loader sass-loader mini-css-extract-plugin
</code></pre></div><p><code>webpack.config.js</code> 에서</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#859900>const</span> <span style=color:#268bd2>MiniCssExtractPlugin</span> = <span style=color:#268bd2>require</span>(<span style=color:#2aa198>&#34;mini-css-extract-plugin&#34;</span>);

<span style=color:#268bd2>module</span>.<span style=color:#268bd2>exports</span> = {
  <span style=color:#268bd2>module</span>: {
	<span style=color:#268bd2>rules</span>: [
	  ...
	  {
	    <span style=color:#268bd2>test</span>: <span style=color:#2aa198>/\.css$/</span>,
		<span style=color:#268bd2>use</span>: [<span style=color:#268bd2>MiniCssExtractPlugin</span>.<span style=color:#268bd2>loader</span>, <span style=color:#2aa198>&#34;css-loader&#34;</span>],
	  },
	  {
        <span style=color:#268bd2>test</span>: <span style=color:#2aa198>/\.s[ac]ss$/</span>,
        <span style=color:#268bd2>use</span>: [<span style=color:#268bd2>MiniCssExtractPlugin</span>.<span style=color:#268bd2>loader</span>, <span style=color:#2aa198>&#34;css-loader&#34;</span>, <span style=color:#2aa198>&#34;sass-loader&#34;</span>],
      },
    ],
  },
  <span style=color:#268bd2>plugins</span>: [
    <span style=color:#859900>new</span> <span style=color:#268bd2>MiniCssExtractPlugin</span>({
      <span style=color:#268bd2>filename</span>: <span style=color:#2aa198>&#34;style.css&#34;</span>,
    }),
  ],
}
</code></pre></div><p>이제 웹팩은 파일을 읽어나가다가 css나 sass를 만나면 정리해서 <code>./dist/static/style.css</code>로 저장을 해 준다.</p><p>그런데 살다보니까 매번 브라우저를 열고 새로고침을 하는 것이 힘들 때가 있다. 이런 사람을 위해 누군가가 <code>webpack-dev-server</code>라는 것을 만들어 놨다.</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm i -D webpack-dev-server
</code></pre></div><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#268bd2>module</span>.<span style=color:#268bd2>exports</span> = {
  ...
  <span style=color:#268bd2>devServer</span>: {
    <span style=color:#268bd2>contentBase</span>: <span style=color:#268bd2>path</span>.<span style=color:#268bd2>join</span>(<span style=color:#268bd2>__dirname</span>, <span style=color:#2aa198>&#34;./dist&#34;</span>),
    <span style=color:#268bd2>publicPath</span>: <span style=color:#2aa198>&#34;/static/&#34;</span>,
    <span style=color:#268bd2>compress</span>: <span style=color:#859900;font-weight:700>true</span>,
    <span style=color:#268bd2>port</span>: <span style=color:#2aa198;font-weight:700>5500</span>,
    <span style=color:#268bd2>hot</span>: <span style=color:#859900;font-weight:700>true</span>,
  },
}
</code></pre></div><p><code>contentBase</code>에 있는 파일들을 static file로 제공해주고 번들링을 한 결과는 따로 파일로 저장하지 않지만 <code>/static/</code>에서 제공한다. 예를들면 <code>localhost:5500/static/bundle.js</code>가 번들된 자바스크립트파일이다.</p><p>그런데 html 파일은 어떻게 할까? 이 역시 플러그인을 사용하자</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm i -D html-webpack-plugin html-webpack-harddisk-plugin
</code></pre></div><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#859900>const</span> <span style=color:#268bd2>HtmlWebpackPlugin</span> = <span style=color:#268bd2>require</span>(<span style=color:#2aa198>&#34;html-webpack-plugin&#34;</span>);
<span style=color:#859900>const</span> <span style=color:#268bd2>HtmlWebpackHarddiskPlugin</span> = <span style=color:#268bd2>require</span>(<span style=color:#2aa198>&#34;html-webpack-harddisk-plugin&#34;</span>)

<span style=color:#268bd2>module</span>.<span style=color:#268bd2>exports</span> = {
  ...
  <span style=color:#268bd2>plugin</span>: [
    <span style=color:#859900>new</span> <span style=color:#268bd2>HtmlWebpackPlugin</span>({
      <span style=color:#268bd2>template</span>: <span style=color:#268bd2>path</span>.<span style=color:#268bd2>resolve</span>(<span style=color:#268bd2>__dirname</span>, <span style=color:#2aa198>&#34;./public/index.html&#34;</span>),
      <span style=color:#268bd2>filename</span>: <span style=color:#268bd2>path</span>.<span style=color:#268bd2>resolve</span>(<span style=color:#268bd2>__dirname</span>, <span style=color:#2aa198>&#34;./dist/index.html&#34;</span>),
      <span style=color:#268bd2>inject</span>: <span style=color:#859900;font-weight:700>true</span>, <span style=color:#93a1a1;font-style:italic>// inject built script in the end of body tag
</span><span style=color:#93a1a1;font-style:italic></span>      <span style=color:#268bd2>alwaysWriteToDisk</span>: <span style=color:#859900;font-weight:700>true</span>,
    }),
    <span style=color:#859900>new</span> <span style=color:#268bd2>HtmlWebpackHarddiskPlugin</span>(),
  ]
}
</code></pre></div><p>이제 웹팩은 <code>./public/index.html</code> 파일을 여러가지 작업(minify, 헤더에 css 파일 추가, 바디 태그 끝에 번들된 자바스크립트 추가)을 한 후 <code>./dist/index.html</code>파일로 저장한다.</p><p>그리고 쓰다보니 빌드를 하기 전에 배포파일을 저장하는 폴더를 다 지워주었으면 좋겠다는 생각이 들 수도 있다.</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm i -D clean-webpack-plugin
</code></pre></div><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#859900>const</span> { <span style=color:#268bd2>CleanWebpackPlugin</span> } = <span style=color:#268bd2>require</span>(<span style=color:#2aa198>&#34;clean-webpack-plugin&#34;</span>);

<span style=color:#268bd2>module</span>.<span style=color:#268bd2>exports</span> = {
  ...
  <span style=color:#268bd2>plugins</span>: [
    <span style=color:#859900>new</span> <span style=color:#268bd2>CleanWebpackPlugin</span>({
      <span style=color:#268bd2>cleanAfterEveryBuildPatterns</span>: [<span style=color:#2aa198>&#34;dist&#34;</span>],
    }),
	...
  ]
}
</code></pre></div><p>더불어 <code>package.json</code>에 스크립트를 만들자:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#268bd2;font-weight:700>&#34;scripts&#34;</span>: {
    <span style=color:#268bd2;font-weight:700>&#34;build&#34;</span>: <span style=color:#2aa198>&#34;webpack --config webpack.config.production.js&#34;</span>,
    <span style=color:#268bd2;font-weight:700>&#34;dev&#34;</span>: <span style=color:#2aa198>&#34;webpack-dev-server --open --config webpack.config.dev.js&#34;</span>
  },
}
</code></pre></div><p>위에는 안썼는데 사실 개발용 설정과 배포용 설정 파일을 나눠놨다. 이것은 숙제 ㅎㅎ</p><h3 id=참고문헌>참고문헌</h3><ul><li><a href=https://poiemaweb.com/es6-babel-webpack-2>누군가의 블로그</a></li></ul><h1 id=jest를-사용해보자>Jest를 사용해보자</h1><p>Jest는 자동으로 테스트를 해준다.</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm i -D jest
</code></pre></div><p><code>package.json</code>에서</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#268bd2;font-weight:700>&#34;scripts&#34;</span>: {
    <span style=color:#268bd2;font-weight:700>&#34;test&#34;</span>: <span style=color:#2aa198>&#34;jest --watch&#34;</span>,
  }
}
</code></pre></div><p>이제 <code>npm run test</code>를 하면 테스트를 실행시켜준다. <code>--watch</code>는 파일 변경이 있으면 자동으로 테스트를 다시 하라는 의미. 테스트는 <code>__tests__</code> 폴더 안에 있는 <code>.js</code> 파일이다. 이게 싫으면 그냥 확장자 앞에 <code>.test</code> 또는 <code>.spec</code>을 붙일 수도 있다. 예를들면 <code>Component.test.js</code>. 사실 더 자세하고 설정도 할 수 있는데 이건 숙제.</p><p>하나 만들어 보자:</p><p>tt.js</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#859900>import</span> <span style=color:#2aa198>&#34;./style.css&#34;</span>

<span style=color:#859900>export</span> <span style=color:#859900>default</span> <span style=color:#859900>function</span> <span style=color:#268bd2>tt</span>(){<span style=color:#859900>return</span> <span style=color:#2aa198;font-weight:700>1</span>;}
</code></pre></div><p>테스트 파일은
tt.test.js</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#859900>import</span> <span style=color:#268bd2>tt</span> <span style=color:#268bd2>from</span> <span style=color:#2aa198>&#34;./tt&#34;</span>
<span style=color:#268bd2>describe</span>(<span style=color:#2aa198>&#34;tt&#34;</span>, () =&gt;{
  <span style=color:#268bd2>it</span>(<span style=color:#2aa198>&#34;returns 1&#34;</span>, () =&gt; {
	<span style=color:#268bd2>expect</span>(<span style=color:#268bd2>tt</span>()).<span style=color:#268bd2>toBe</span>(<span style=color:#2aa198;font-weight:700>1</span>);
  })
})
</code></pre></div><p>이제 실행시켜보자.</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm run <span style=color:#cb4b16>test</span>
</code></pre></div><p>어라? 오류가 난다. <code>import "./style.css"</code>를 어떻게 이해할지 모르기 때문. 테스트할때는 스타일이 필요 없으니 대충 속이자.</p><p><code>jest.config.js</code></p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#268bd2>module</span>.<span style=color:#268bd2>exports</span> = {
  <span style=color:#268bd2>moduleNameMapper</span>: {
    <span style=color:#2aa198>&#34;\\.(css|less|sass|scss)$&#34;</span>: <span style=color:#2aa198>&#34;&lt;rootDir&gt;/src/lib/__mocks__/styleMock.js&#34;</span>,
  },
};
</code></pre></div><p>그리고 위의 해당 파일(styleMock.js)는 빈 모듈이다:</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#268bd2>module</span>.<span style=color:#268bd2>exports</span> = {}
</code></pre></div><p>이러면 jest는 css 파일을 빈 모듈로 착각해 신경쓰지 않고 아무 문제 없이 테스트를 진행한다.</p><h3 id=dom-테스트가-힘들-때>Dom 테스트가 힘들 때</h3><p>위의 세팅을 다 해놓고 dom을 테스트하려하는데 막막한가? jest는 기본적인 검사함수밖에 주지 않는다. 이를 불편하게 여긴 어떤 사람이 또 패키지를 만들었다.</p><div class=highlight><pre style=color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>npm i -D @testing-library/dom
</code></pre></div><p>이 패키지는 getByText(dom, &ldquo;aaa&rdquo;)과 같은 편리한 함수들을 제공해준다. 사용법은 숙제.</p></article></div></div></body></html>